--------AVEIRO
------A_R1
ipv6 unicast-routing 
ip route 0.0.0.0 0.0.0.0 10.100.1.1


--INT tunnel 0
  int t0
    ip add 10.1.3.1 255.255.255.252
    tunnel mode gre ip 
    tunnel source 10.1.3.1
    tunnel destination 10.1.3.2
    no shut
    exit

--INT_F0/0
int f0/0
ip add 101.1.0.1 255.255.255.252
no shut
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:110::1/64
ip nat inside

--INT_F1/0
int f1/0
ip add 101.1.1.1 255.255.255.252
ip address 200.1.0.1 255.255.255.128 secondary
no shut
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:111::1/64
ip nat inside

--INT_F1/1
int f1/1
ip add 10.100.1.2 255.255.255.252
no shut
ip ospf 4 area 0
ip nat outside

--OSPF_1
router ospf 1
network 201.0.0.0 0.0.0.127 area 0 
default-information originate always metric 10
redistribute ospf 4 subnets
router-id 1.1.1.1
ipv6 router ospf 1
router-id 1.1.1.1

--OSPF_4
router ospf 4
router-id 11.11.11.11
redistribute ospf 1 subnets
distribute-list 50 out
ipv6 router ospf 4
router-id 11.11.11.11

--SNAT CONFIGURATION
access-list 50 deny 101.0.0.0 0.255.255.255
access-list 50 permit any
access-list 1 permit 101.0.0.0  0.255.255.255
ip nat pool POOLR 200.1.0.10 200.1.0.126 netmask 255.255.255.128
ip nat Stateful id 2
        backup 101.1.1.1
            peer 101.1.2.1
            mapping-id 10
    ip nat inside source list 1 pool POOLR mapping-id 10 overload 

------A_R2
ipv6 unicast-routing 
ip route 0.0.0.0 0.0.0.0 10.100.1.1

--INT_F0/0
int f0/0
ip add 101.1.0.2 255.255.255.252
no shut
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:110::2/64
ip nat inside

--INT tunnel 0
  int t0
    ip add 10.1.3.3 255.255.255.252
    tunnel mode gre ip 
    tunnel source 10.1.3.3
    tunnel destination 10.1.3.2
    no shut
    exit
--SNAT CONFIGURATION
access-list 60 deny 101.0.0.0 0.255.255.255
access-list 60 permit any
access-list 1 permit 101.0.0.0 0.255.255.255
ip nat Stateful id 3
    primary 101.1.2.1
        peer 101.1.1.1
        mapping-id 10
ip nat inside source list 1 pool POOLR mapping-id 10 overload 

--INT_F1/0
int f1/0
ip add 101.1.2.1 255.255.255.252
ip address 200.1.0.2 255.255.255.128 secondary
no shut
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:112::1/64
ip nat inside

--INT_F1/1
int f1/1
ip add 10.100.2.2 255.255.255.252
no shut
ip ospf 4 area 0
ip nat outside

--OSPF_1
router ospf 1
router-id 2.2.2.2
network 201.0.0.0 0.0.0.127 area 0 
default-information originate always metric 5
ipv6 router ospf 1
router-id 2.2.2.2

--OSPF_4
router ospf 4
router-id 12.12.12.12
ipv6 router ospf 4
router-id 12.12.12.12

------A_ESW1
ip routing
ipv6 unicast-routing 
int range f1/2 - 4
switchport mode trunk
switchport trunk allowed vlan 1,2,8,1002-1005

----VLAN_ESW1
vlan database
vlan 1
vlan 2
vlan 8
exit

--INT_F1/0
int f1/0
no switchport
ip add 101.1.1.2 255.255.255.252
no shut
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:111::2/64

--INT_F1/1
int f1/1
no switchport
ip add 101.1.2.2 255.255.255.252
no shut
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:112::2/64

--ADMIN
int vlan 2
ip address 101.2.0.1 255.255.255.0
no autostate    
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:120::1/64

--PUBLIC_DATACENTER
int vlan 8
ip address 101.8.0.1 255.255.255.0
no autostate
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:1E0::1/64

--OSPF_1
router ospf 1
router-id 3.3.3.3
ipv6 router ospf 1
router-id 3.3.3.3

------A_E1
ip routing
ipv6 unicast-routing 
int range f1/0 - 1
switchport mode trunk
switchport trunk allowed vlan 1,2,1002-1005 

----VLANS_E1
vlan database
vlan 1
vlan 2
vlan 31
vlan 41
exit

--ADMIN
int vlan 2
ip address 101.2.0.2 255.255.255.0
no autostate
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:120::2/64

--WORKER_E1
int vlan 31
ip address 101.3.1.1 255.255.255.0
no autostate
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:131::1/64

--GUEST_E1
int vlan 41
ip address 101.4.1.1 255.255.255.0
no autostate
ip ospf 1 area 0
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:141::1/64

router ospf 1
router-id 4.4.4.4
ipv6 router ospf 1
router-id 4.4.4.4

------A_E2
ip routing
ipv6 unicast-routing
int range f1/0 - 1
switchport mode trunk
switchport trunk allowed vlan 1,2,1002-1005 

----VLANS_E2
vlan database
vlan 1
vlan 2
vlan 32
vlan 42
exit

--ADMIN
int vlan 2
ip address 101.2.0.3 255.255.255.0
no autostate
ip ospf 1 area 0
ip helper-address 101.8.0.3
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:120::3/64

--WORKER_E2
int vlan 32
ip address 101.3.2.1 255.255.255.0
no autostate
ip ospf 1 area 0
ip helper-address 101.8.0.3
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:132::1/64

--GUEST_E2
int vlan 42
ip address 101.4.2.1 255.255.255.0
no autostate
ip ospf 1 area 0
ip helper-address 101.8.0.3
ipv6 enable
ipv6 ospf 1 area 0
ipv6 address 2100:1:1:142::1/64

--OSPF_1
router ospf 1
redistribute ospf 1 subnets
router-id 5.5.5.5
ipv6 router ospf 1
router-id 5.5.5.5


--SNAT CONFIGURATION

    --A_R1
    access-list 1 permit A_ESW1(F1/0)  0.255.255.255
    access-list 1 permit A_ESW1(F1/1)  0.255.255.255
    ip nat pool POOLR 200.1.0.1 200.1.0.126 netmask 255.255.255.128
    ip nat Stateful id 2
         backup A_R1(F1/0)
             peer A_R2(1/0)
             mapping_id 10
     ip nat inside source list 1 pool POOLR mapping-id 10 overload 


    --A_R2
    access-list 1 permit F1/0  0.255.255.255
    access-list 1 permit F1/1  0.255.255.255
    ip nat pool POOLR 200.1.0.1 200.1.0.126 netmask 255.255.255.128 
    ip nat inside source list 1 pool POOLR overload 
    ip nat Stateful id 3
        primary A_R2(F1/0)
            peer AR_1(1/0)
            mapping-id 10
    ip nat inside source list 1 pool POOLR mapping-id 10 overload


    --TUNNEL CONFIGURATION
    int t0
    ip add 10.1.3.1 255.255.255.252
    tunnel mode gre ip 
    tunnel source 10.1.3.1
    tunnel destination 10.1.3.2
    no shut
    exit

